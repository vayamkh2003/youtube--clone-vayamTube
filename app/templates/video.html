{% extends 'base.html' %}

{% block content %}

<div class="container" style="margin-top:20px;">
    <div class="row">
        <div class="col-12 col-md-8">
            <div id="playerWrapper" class="position-relative" style="min-height:200px;">
                <div id="loader" class="d-flex justify-content-center align-items-center position-absolute w-100 h-100" style="background: rgba(0,0,0,0.3); z-index:10;">
                    <div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div>
                </div>
                <video id="videoPlayer" class="skeleton" width="100%" controls>
                    <source src="{{video.video_file.url}}" type="video/mp4">
                </video>
            </div>
            <p class="mt-2">{{video.number_of_views}} views</p>
        </div>

        <div class="col-12 col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{video.title}}</strong>
                            <div class="text-muted small"><img src="{{video.channel.profile_picture.url}}" class="rounded-circle avatar-sm me-2" alt="{{video.channel.name}}">{{video.channel.name}} Â· {{video.upload_time|date:"M d, Y"}}</div>
                        </div>
                        <div class="text-end">
                            {% if request.user in video.likes.all %}
                                <a href="{% url 'video-like' video.id %}" class="btn btn-outline-primary btn-sm">ğŸ‘ {{video.number_of_likes}}</a>
                            {% else %}
                                <a href="{% url 'video-like' video.id %}" class="btn btn-outline-secondary btn-sm">ğŸ‘ {{video.number_of_likes}}</a>
                            {% endif %}
                            {% if request.user in video.dislikes.all %}
                                <a href="{% url 'video-dislike' video.id %}" class="btn btn-outline-danger btn-sm">ğŸ‘ {{video.number_of_dislikes}}</a>
                            {% else %}
                                <a href="{% url 'video-dislike' video.id %}" class="btn btn-outline-secondary btn-sm">ğŸ‘ {{video.number_of_dislikes}}</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p>{{video.description}}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('videoPlayer');
    const loader = document.getElementById('loader');
    video.addEventListener('canplay', function(){
        loader.style.display = 'none';
    });
</script>

    <div class="card text-center" style="margin: 10px;">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item" style="margin-right: 5px;">
                    {% if request.user in video.likes.all %}
                    <a href="{% url 'video-like' video.id %}"><i class="fa-solid fa-thumbs-up"></i></a>
                    {% else %}
                        <a href="{% url 'video-like' video.id %}"><i class="fa-regular fa-thumbs-up"></i></a>
                    {% endif %}
                </li>
                <li class="nav-item" style="margin-right: 10px;">
                    <p>{{video.number_of_likes}}</p>
                </li>
                <li class="nav-item" style="margin-right: 5px;">
                    {% if request.user in video.dislikes.all %}
                    <a href="{% url 'video-dislike' video.id %}"><i class="fa-solid fa-thumbs-down"></i></a>
                    {% else %}
                        <a href="{% url 'video-dislike' video.id %}"><i class="fa-regular fa-thumbs-down"></i></a>
                    {% endif %}
                </li>
                <li class="nav-item" style="margin-right: 10px;">
                    <p>{{video.number_of_dislikes}}</p>
                </li>
            </ul>
        </div>
    </div>
        <div class="card" style="margin: 20px; width: 80%;">
            <div class="card-body">
                <h4 class="card-title">{{video.title}}</h4>
                <h6 class="card-text">{{video.description}}</h6>
                <p class="card-text">{{video.upload_time}}</p>
            </div>
        </div>
    </div>

    <h4 style="margin-left: 10%;">Create a comment</h4>

    <form method="post" action="{% url 'video-comment' video.id %}">
        {% csrf_token %}
        <div class="form-group" style="width: 80%; margin-left: 10%;">
            <textarea class="form-control" name="comment" rows="3" cols="120"></textarea>
        </div><br>
        <div class="text-center">
            <button type="submit" class="btn btn-success">Post</button>
        </div>

    </form>
</div>

<h2 class="mt-4">Comments</h2>
<div class="card p-3 mb-4">
    <ul class="list-unstyled mb-0">
        {% for comment in video.comments.all %}
            <li class="d-flex mb-3">
                <img src="{{comment.user.userprofile.profile_picture.url}}" class="rounded-circle avatar-sm me-3" alt="{{comment.user.username}}">
                <div>
                    <p class="mb-1"><strong>{{comment.user.username}}</strong> <small class="text-muted">Â· {{comment.created_at|date:"M d, Y H:i"}}</small></p>
                    <p class="mb-0">{{comment.text}}</p>
                </div>
            </li>
        {% empty %}
            <p>No comments yet</p>
        {% endfor %}
    </ul>
</div>

{% endblock %}